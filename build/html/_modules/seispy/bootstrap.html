

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>seispy.bootstrap &mdash; seispy latest documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/seispy.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'latest',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> seispy
          

          
            
            <img src="../../_static/seispy_100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/quickstart.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Module Index</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">seispy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>seispy.bootstrap</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for seispy.bootstrap</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">sqrt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pyerf</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">s2</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_ncdf_py</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">pyerf</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">s2</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_nppf_py</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">pyerf</span><span class="o">.</span><span class="n">erfinv</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="n">nppf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">_nppf_py</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">])</span>
<span class="n">ncdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">_ncdf_py</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">])</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.0.0&#39;</span>

<span class="c1"># Keep python 2/3 compatibility, without using six. At some point,</span>
<span class="c1"># we may need to add six as a requirement, but right now we can avoid it.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">xrange</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="n">xrange</span> <span class="o">=</span> <span class="nb">range</span>


<div class="viewcode-block" id="InstabilityWarning"><a class="viewcode-back" href="../../seispy.html#seispy.bootstrap.InstabilityWarning">[docs]</a><span class="k">class</span> <span class="nc">InstabilityWarning</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Issued when results may be unstable.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>


<span class="c1"># On import, make sure that InstabilityWarnings are not filtered out.</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="n">InstabilityWarning</span><span class="p">)</span>


<div class="viewcode-block" id="ci"><a class="viewcode-back" href="../../seispy.html#seispy.bootstrap.ci">[docs]</a><span class="k">def</span> <span class="nf">ci</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">statfunction</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
       <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bca&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;lowhigh&#39;</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">multi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
       <span class="n">_iter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Given a set of data ``data``, and a statistics function ``statfunction`` that</span>
<span class="sd">applies to that data, computes the bootstrap confidence interval for</span>
<span class="sd">``statfunction`` on that data. Data points are assumed to be delineated by</span>
<span class="sd">axis 0.</span>

<span class="sd">Parameters</span>
<span class="sd">----------</span>
<span class="sd">data: array_like, shape (N, ...) OR tuple of array_like all with shape (N, ...)</span>
<span class="sd">    Input data. Data points are assumed to be delineated by axis 0. Beyond this,</span>
<span class="sd">    the shape doesn&#39;t matter, so long as ``statfunction`` can be applied to the</span>
<span class="sd">    array. If a tuple of array_likes is passed, then samples from each array (along</span>
<span class="sd">    axis 0) are passed in order as separate parameters to the statfunction. The</span>
<span class="sd">    type of data (single array or tuple of arrays) can be explicitly specified</span>
<span class="sd">    by the multi parameter.</span>
<span class="sd">statfunction: function (data, weights=(weights, optional)) -&gt; value</span>
<span class="sd">    This function should accept samples of data from ``data``. It is applied</span>
<span class="sd">    to these samples individually.</span>

<span class="sd">    If using the ABC method, the function _must_ accept a named ``weights``</span>
<span class="sd">    parameter which will be an array_like with weights for each sample, and</span>
<span class="sd">    must return a _weighted_ result. Otherwise this parameter is not used</span>
<span class="sd">    or required. Note that numpy&#39;s np.average accepts this. (default=np.average)</span>
<span class="sd">alpha: float or iterable, optional</span>
<span class="sd">    The percentiles to use for the confidence interval (default=0.05). If this</span>
<span class="sd">    is a float, the returned values are (alpha/2, 1-alpha/2) percentile confidence</span>
<span class="sd">    intervals. If it is an iterable, alpha is assumed to be an iterable of</span>
<span class="sd">    each desired percentile.</span>
<span class="sd">n_samples: float, optional</span>
<span class="sd">    The number of bootstrap samples to use (default=10000)</span>
<span class="sd">method: string, optional</span>
<span class="sd">    The method to use: one of &#39;pi&#39;, &#39;bca&#39;, or &#39;abc&#39; (default=&#39;bca&#39;)</span>
<span class="sd">output: string, optional</span>
<span class="sd">    The format of the output. &#39;lowhigh&#39; gives low and high confidence interval</span>
<span class="sd">    values. &#39;errorbar&#39; gives transposed abs(value-confidence interval value) values</span>
<span class="sd">    that are suitable for use with matplotlib&#39;s errorbar function. (default=&#39;lowhigh&#39;)</span>
<span class="sd">epsilon: float, optional (only for ABC method)</span>
<span class="sd">    The step size for finite difference calculations in the ABC method. Ignored for</span>
<span class="sd">    all other methods. (default=0.001)</span>
<span class="sd">multi: boolean, optional</span>
<span class="sd">    If False, assume data is a single array. If True, assume data is a tuple/other</span>
<span class="sd">    iterable of arrays of the same length that should be sampled together. If None,</span>
<span class="sd">    decide based on whether the data is an actual tuple. (default=None)</span>

<span class="sd">Returns</span>
<span class="sd">-------</span>
<span class="sd">confidences: tuple of floats</span>
<span class="sd">    The confidence percentiles specified by alpha</span>

<span class="sd">Calculation Methods</span>
<span class="sd">-------------------</span>
<span class="sd">&#39;pi&#39;: Percentile Interval (Efron 13.3)</span>
<span class="sd">    The percentile interval method simply returns the 100*alphath bootstrap</span>
<span class="sd">    sample&#39;s values for the statistic. This is an extremely simple method of</span>
<span class="sd">    confidence interval calculation. However, it has several disadvantages</span>
<span class="sd">    compared to the bias-corrected accelerated method, which is the default.</span>
<span class="sd">&#39;bca&#39;: Bias-Corrected Accelerated (BCa) Non-Parametric (Efron 14.3) (default)</span>
<span class="sd">    This method is much more complex to explain. However, it gives considerably</span>
<span class="sd">    better results, and is generally recommended for normal situations. Note</span>
<span class="sd">    that in cases where the statistic is smooth, and can be expressed with</span>
<span class="sd">    weights, the ABC method will give approximated results much, much faster.</span>
<span class="sd">    Note that in a case where the statfunction results in equal output for every</span>
<span class="sd">    bootstrap sample, the BCa confidence interval is technically undefined, as</span>
<span class="sd">    the acceleration value is undefined. To match the percentile interval method</span>
<span class="sd">    and give reasonable output, the implementation of this method returns a</span>
<span class="sd">    confidence interval of zero width using the 0th bootstrap sample in this</span>
<span class="sd">    case, and warns the user.</span>
<span class="sd">&#39;abc&#39;: Approximate Bootstrap Confidence (Efron 14.4, 22.6)</span>
<span class="sd">    This method provides approximated bootstrap confidence intervals without</span>
<span class="sd">    actually taking bootstrap samples. This requires that the statistic be</span>
<span class="sd">    smooth, and allow for weighting of individual points with a weights=</span>
<span class="sd">    parameter (note that np.average allows this). This is _much_ faster</span>
<span class="sd">    than all other methods for situations where it can be used.</span>

<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">To calculate the confidence intervals for the mean of some numbers:</span>

<span class="sd">&gt;&gt; boot.ci( np.randn(100), np.average )</span>

<span class="sd">Given some data points in arrays x and y calculate the confidence intervals</span>
<span class="sd">for all linear regression coefficients simultaneously:</span>

<span class="sd">&gt;&gt; boot.ci( (x,y), scipy.stats.linregress )</span>

<span class="sd">References</span>
<span class="sd">----------</span>
<span class="sd">Efron, An Introduction to the Bootstrap. Chapman &amp; Hall 1993</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Deal with the alpha values</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
        <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">multi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">multi</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">multi</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">statfunction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_iter</span><span class="p">:</span>
            <span class="n">statfunction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">statfunc_wrapper</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">statfunction</span> <span class="o">=</span> <span class="n">statfunc_wrapper</span>

    <span class="c1"># Ensure that the data is actually an array. This isn&#39;t nice to pandas,</span>
    <span class="c1"># but pandas seems much much slower and the indexes become a problem.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">multi</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">tdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tdata</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

    <span class="c1"># Deal with ABC *now*, as it doesn&#39;t need samples.</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;abc&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">nn</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="n">tdata</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">p0</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;statfunction does not accept correct arguments for ABC (</span><span class="si">{0}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>

        <span class="n">di_full</span> <span class="o">=</span> <span class="n">I</span> <span class="o">-</span> <span class="n">p0</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">((</span><span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="n">tdata</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">p0</span> <span class="o">+</span> <span class="n">ep</span> <span class="o">*</span> <span class="n">di</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">di_full</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">((</span><span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="n">tdata</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">p0</span> <span class="o">-</span> <span class="n">ep</span> <span class="o">*</span> <span class="n">di</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">di</span> <span class="ow">in</span> <span class="n">di_full</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">-</span> <span class="n">tm</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ep</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">tm</span><span class="p">)</span> <span class="o">/</span> <span class="n">ep</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="n">sighat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">t1</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">t1</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sighat</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sighat</span><span class="p">)</span>
        <span class="n">cq</span> <span class="o">=</span> <span class="p">(</span><span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="n">tdata</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">p0</span> <span class="o">+</span> <span class="n">ep</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="n">tdata</span><span class="p">,</span>
                                                                                    <span class="n">weights</span><span class="o">=</span><span class="n">p0</span> <span class="o">-</span> <span class="n">ep</span> <span class="o">*</span> <span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                         <span class="mi">2</span> <span class="o">*</span> <span class="n">sighat</span> <span class="o">*</span> <span class="n">ep</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">bhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">curv</span> <span class="o">=</span> <span class="n">bhat</span> <span class="o">/</span> <span class="n">sighat</span> <span class="o">-</span> <span class="n">cq</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">nppf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ncdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">ncdf</span><span class="p">(</span><span class="o">-</span><span class="n">curv</span><span class="p">))</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">+</span> <span class="n">nppf</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span>
        <span class="n">za</span> <span class="o">=</span> <span class="n">Z</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">Z</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c1"># stan = t0 + sighat * nppf(alphas)</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">alphas</span><span class="p">)):</span>
            <span class="n">abc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="n">tdata</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">p0</span> <span class="o">+</span> <span class="n">za</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;lowhigh&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">abc</span>
        <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;errorbar&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">abc</span> <span class="o">-</span> <span class="n">statfunction</span><span class="p">(</span><span class="n">tdata</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Output option </span><span class="si">{0}</span><span class="s2"> is not supported.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

    <span class="c1"># We don&#39;t need to generate actual samples; that would take more memory.</span>
    <span class="c1"># Instead, we can generate just the indexes, and then apply the statfun</span>
    <span class="c1"># to those indexes.</span>
    <span class="k">if</span> <span class="n">_iter</span><span class="p">:</span>
        <span class="n">bootindexes</span> <span class="o">=</span> <span class="n">bootstrap_indexes</span><span class="p">(</span><span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tdata</span><span class="p">))</span>
                         <span class="k">for</span> <span class="n">indexes</span> <span class="ow">in</span> <span class="n">bootindexes</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bootindexes</span> <span class="o">=</span> <span class="n">bootstrap_indexes_array</span><span class="p">(</span><span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">)</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">bootindexes</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tdata</span><span class="p">))</span>

    <span class="n">stat</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Percentile Interval Method</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;pi&#39;</span><span class="p">:</span>
        <span class="n">avals</span> <span class="o">=</span> <span class="n">alphas</span>

    <span class="c1"># Bias-Corrected Accelerated Method</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;bca&#39;</span><span class="p">:</span>

        <span class="c1"># The value of the statistic function applied just to the actual data.</span>
        <span class="n">ostat</span> <span class="o">=</span> <span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="n">tdata</span><span class="p">)</span>

        <span class="c1"># The bias correction value.</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">nppf</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">stat</span> <span class="o">&lt;</span> <span class="n">ostat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">n_samples</span><span class="p">)</span>

        <span class="c1"># Statistics of the jackknife distribution</span>
        <span class="n">jackindexes</span> <span class="o">=</span> <span class="n">jackknife_indexes</span><span class="p">(</span><span class="n">tdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">jstat</span> <span class="o">=</span> <span class="p">[</span><span class="n">statfunction</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tdata</span><span class="p">))</span> <span class="k">for</span> <span class="n">indexes</span> <span class="ow">in</span> <span class="n">jackindexes</span><span class="p">]</span>
        <span class="n">jmean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">jstat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Temporarily kill numpy warnings:</span>
        <span class="n">oldnperr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="c1"># Acceleration value</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">jmean</span> <span class="o">-</span> <span class="n">jstat</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="mf">6.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">jmean</span> <span class="o">-</span> <span class="n">jstat</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
            <span class="n">nanind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;BCa acceleration values for indexes </span><span class="si">{}</span><span class="s2"> were undefined. </span><span class="se">\</span>
<span class="s2">Statistic values were likely all equal. Affected CI will </span><span class="se">\</span>
<span class="s2">be inaccurate.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nanind</span><span class="p">),</span> <span class="n">InstabilityWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">zs</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">+</span> <span class="n">nppf</span><span class="p">(</span><span class="n">alphas</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">alphas</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">z0</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>

        <span class="n">avals</span> <span class="o">=</span> <span class="n">ncdf</span><span class="p">(</span><span class="n">z0</span> <span class="o">+</span> <span class="n">zs</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">zs</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">oldnperr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Method </span><span class="si">{0}</span><span class="s2"> is not supported.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>

    <span class="n">nvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">n_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">avals</span><span class="p">)</span>

    <span class="n">oldnperr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">nvals</span><span class="p">)):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some values were NaN; results are probably unstable &quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;(all values were probably equal)&quot;</span><span class="p">,</span> <span class="n">InstabilityWarning</span><span class="p">,</span>
                      <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nvals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nvals</span> <span class="o">==</span> <span class="n">n_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some values used extremal samples; &quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;results are probably unstable.&quot;</span><span class="p">,</span>
                      <span class="n">InstabilityWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nvals</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">nvals</span> <span class="o">&gt;=</span> <span class="n">n_samples</span> <span class="o">-</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Some values used top 10 low/high samples; &quot;</span> <span class="o">+</span>
                      <span class="s2">&quot;results may be unstable.&quot;</span><span class="p">,</span>
                      <span class="n">InstabilityWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">oldnperr</span><span class="p">)</span>

    <span class="n">nvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">nvals</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;lowhigh&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nvals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># All nvals are the same. Simple broadcasting</span>
            <span class="k">return</span> <span class="n">stat</span><span class="p">[</span><span class="n">nvals</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Nvals are different for each data point. Not simple broadcasting.</span>
            <span class="c1"># Each set of nvals along axis 0 corresponds to the data at the same</span>
            <span class="c1"># point in other axes.</span>
            <span class="k">return</span> <span class="n">stat</span><span class="p">[(</span><span class="n">nvals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">nvals</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())]</span>
    <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;errorbar&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nvals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">statfunction</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">stat</span><span class="p">[</span><span class="n">nvals</span><span class="p">])[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">statfunction</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">stat</span><span class="p">[(</span><span class="n">nvals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">nvals</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])])[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Output option </span><span class="si">{0}</span><span class="s2"> is not supported.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span></div>


<div class="viewcode-block" id="bootstrap_indexes"><a class="viewcode-back" href="../../seispy.html#seispy.bootstrap.bootstrap_indexes">[docs]</a><span class="k">def</span> <span class="nf">bootstrap_indexes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Given data points data, where axis 0 is considered to delineate points, return</span>
<span class="sd">an generator for sets of bootstrap indexes. This can be used as a list</span>
<span class="sd">of bootstrap indexes (with list(bootstrap_indexes(data))) as well.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span></div>


<div class="viewcode-block" id="bootstrap_indexes_array"><a class="viewcode-back" href="../../seispy.html#seispy.bootstrap.bootstrap_indexes_array">[docs]</a><span class="k">def</span> <span class="nf">bootstrap_indexes_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">randint</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>


<div class="viewcode-block" id="jackknife_indexes"><a class="viewcode-back" href="../../seispy.html#seispy.bootstrap.jackknife_indexes">[docs]</a><span class="k">def</span> <span class="nf">jackknife_indexes</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Given data points data, where axis 0 is considered to delineate points, return</span>
<span class="sd">a list of arrays where each array is a set of jackknife indexes.</span>

<span class="sd">For a given set of data Y, the jackknife sample J[i] is defined as the data set</span>
<span class="sd">Y with the ith data point deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">base</span><span class="p">)</span></div>


<div class="viewcode-block" id="subsample_indexes"><a class="viewcode-back" href="../../seispy.html#seispy.bootstrap.subsample_indexes">[docs]</a><span class="k">def</span> <span class="nf">subsample_indexes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Given data points data, where axis 0 is considered to delineate points, return</span>
<span class="sd">a list of arrays where each array is indexes a subsample of the data of size</span>
<span class="sd">``size``. If size is &gt;= 1, then it will be taken to be an absolute size. If</span>
<span class="sd">size &lt; 1, it will be taken to be a fraction of the data size. If size == -1, it</span>
<span class="sd">will be taken to mean subsamples the same size as the sample (ie, permuted</span>
<span class="sd">samples)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
    <span class="k">elif</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;size cannot be </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)),</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">base</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">size</span><span class="p">]</span></div>


<div class="viewcode-block" id="bootstrap_indexes_moving_block"><a class="viewcode-back" href="../../seispy.html#seispy.bootstrap.bootstrap_indexes_moving_block">[docs]</a><span class="k">def</span> <span class="nf">bootstrap_indexes_moving_block</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                   <span class="n">block_length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate moving-block bootstrap samples.</span>

<span class="sd">Given data points `data`, where axis 0 is considered to delineate points,</span>
<span class="sd">return a generator for sets of bootstrap indexes. This can be used as a</span>
<span class="sd">list of bootstrap indexes (with list(bootstrap_indexes_moving_block(data))) as</span>
<span class="sd">well.</span>

<span class="sd">Parameters</span>
<span class="sd">----------</span>

<span class="sd">n_samples [default 10000]: the number of subsamples to generate.</span>

<span class="sd">block_length [default 3]: the length of block.</span>

<span class="sd">wrap [default False]: if false, choose only blocks within the data, making</span>
<span class="sd">the last block for data of length L start at L-block_length.  If true, choose</span>
<span class="sd">blocks starting anywhere, and if they extend past the end of the data, wrap</span>
<span class="sd">around to the beginning of the data again.</span>
<span class="sd">&quot;&quot;&quot;</span>
    <span class="n">n_obs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_blocks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">n_obs</span> <span class="o">/</span> <span class="n">block_length</span><span class="p">))</span>
    <span class="n">nexts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">block_length</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:],</span> <span class="n">n_blocks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">wrap</span><span class="p">:</span>
        <span class="n">last_block</span> <span class="o">=</span> <span class="n">n_obs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">last_block</span> <span class="o">=</span> <span class="n">n_obs</span> <span class="o">-</span> <span class="n">block_length</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">n_samples</span><span class="p">):</span>
        <span class="n">blocks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">last_block</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_blocks</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrap</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">blocks</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">nexts</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:</span><span class="n">n_obs</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">((</span><span class="n">blocks</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">nexts</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:</span><span class="n">n_obs</span><span class="p">],</span> <span class="n">n_obs</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Mijian Xu

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>